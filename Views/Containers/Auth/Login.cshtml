@using Tutoree.Utils.Common
@{
    this.ViewData["Title"] = Routers.Login.Title;
}

    <img class="bg" src="/images/login/Background.png"/>
    <img class="bg-decor" src="/images/login/BackgroundDecorator.png"/>
    <img class="bg-decor the-owl" src="/images/login/BackgroundDecorator2.png"
        style="position: fixed;
        width: 60vw;
        height: 80vh;
        top: 7vh;
        left: -3vw;
        object-fit: contain;"/>
    <div class="panel-login position-fixed shadow-lg rounded-panel p-4"
        style="
                width: min(600px, 60vh);
                background-color: var(--color-0);
                right: 10vw;
                top: calc((100vh - min(250px, 25vh))/2 - 6vh);">

            <h3 class="panel-title w-full text-white text-center">
                Đăng nhập
            </h3>

            <div class="google-button text-center bg-white rounded-button p-2" style="position: relative; margin-top: min(75px, 6vh);">
                <img class="ic" 
                    style="width: 2.5rem;"
                    src="/images/login/GoogleIcon.png" />
                <p class="d-inline" style="font-weight: 500;">Đăng nhập với </p>
                <p class="d-inline" style="font-weight: 700; color: #F66A04">FPT Email </p>
                <div class="flex items-center btn-google">

                <div class="btn-google w-100 h-100" style="position: absolute; 
                                                            left: 45px; 
                                                            right: 0; 
                                                            top: 10px;
                                                            margin-left: auto; 
                                                            margin-right: auto; 
                                                            width: 50%; opacity: 0;">
                    <div id="g_id_onload" data-client_id="495690914730-rfa24uuifr2hn5gvmg1s89pm86ju0tik.apps.googleusercontent.com"
                    data-context="signin" data-ux_mode="popup" data-callback="continueWithNextIdp">
                    </div>
                    <div class="w-full g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline"
                        data-text="continue_with" data-size="large" data-locale="en" data-logo_alignment="left">
                        <div class="S9gUrf-YoZ4jf" style="position: relative;">
                            <div></div><iframe
                                src="https://accounts.google.com/gsi/button?type=standard&amp;shape=rectangular&amp;theme=outline&amp;text=continue_with&amp;size=large&amp;logo_alignment=left&amp;client_id=495690914730-4s7m4m4f56eehrma6u112ft1o8gthaus.apps.googleusercontent.com&amp;iframe_id=gsi_973800_212413&amp;as=4ldbeNKxdEU%2Bo9Fzk6dVVw&amp;hl=en"
                                id="gsi_973800_212413" title="Sign in with Google Button"
                                style="display: block; position: relative; top: 0px; left: 0px; height: 44px; width: 255px; border: 0px; margin: -2px -10px;"></iframe>
                        </div>
                    </div>
                </div>
            </div>
            </div>
    </div>

@section Scripts {

<script src="/js/login.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        function continueWithNextIdp(notification) {
            if (notification && notification.credential) {
               const user = jwt_decode(notification.credential);
               if (!user.email.includes(`fpt`)) {
                    alert("Please use your FPT email to login");
                    return;
                }  else {
                    if (user.email == "taittse150194@fpt.edu.vn") {
                        window.location.href = `/home/stu`;
                    } else {
                        window.location.href = `/home/tut`;
                    }
                } 
            }
        }
    </script>
}
